<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 900 720" xmlns="http://www.w3.org/2000/svg">
  <!-- Background Grid Pattern -->
  <defs>
    <pattern id="smallGrid" width="8" height="8" patternUnits="userSpaceOnUse">
      <path d="M 8 0 L 0 0 0 8" fill="none" stroke="#f0f0f0" stroke-width="0.5"/>
    </pattern>
    <pattern id="grid" width="80" height="80" patternUnits="userSpaceOnUse">
      <rect width="80" height="80" fill="url(#smallGrid)"/>
      <path d="M 80 0 L 0 0 0 80" fill="none" stroke="#e0e0e0" stroke-width="1"/>
    </pattern>
    <!-- Arrow Markers -->
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#444"/>
    </marker>
    <marker id="arrow-primary" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1565C0"/>
    </marker>
    <marker id="arrow-secondary" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#673AB7"/>
    </marker>
    <!-- Color Gradients -->
    <linearGradient id="watchkit-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#FC8019" stop-opacity="0.1"/>
      <stop offset="100%" stop-color="#FC8019" stop-opacity="0.3"/>
    </linearGradient>
    <linearGradient id="go-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#00ADD8" stop-opacity="0.1"/>
      <stop offset="100%" stop-color="#00ADD8" stop-opacity="0.3"/>
    </linearGradient>
    <linearGradient id="rust-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#B7410E" stop-opacity="0.1"/>
      <stop offset="100%" stop-color="#B7410E" stop-opacity="0.3"/>
    </linearGradient>
    <linearGradient id="ios-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#007AFF" stop-opacity="0.1"/>
      <stop offset="100%" stop-color="#007AFF" stop-opacity="0.3"/>
    </linearGradient>
  </defs>
  
  <!-- Background Grid -->
  <rect width="100%" height="100%" fill="url(#grid)" opacity="0.3"/>
  
  <!-- Title & Subtitle -->
  <text x="450" y="35" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">WatchKit Emergency SOS Integration Architecture</text>
  <text x="450" y="65" font-family="Arial" font-size="14" text-anchor="middle" font-style="italic">Recursive Cognitive-System Model for Safety-Critical Applications</text>
  
  <!-- iOS & WatchOS Layer -->
  <rect x="150" y="90" width="600" height="120" rx="8" ry="8" fill="#F5F5F5" stroke="#455A64" stroke-width="1.5"/>
  <text x="450" y="115" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Client Layer: iOS + watchOS Integration</text>
  
  <!-- iOS Component -->
  <rect x="180" y="130" width="240" height="60" rx="6" ry="6" fill="url(#ios-gradient)" stroke="#007AFF" stroke-width="2"/>
  <text x="300" y="155" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">iOS Emergency Context Manager</text>
  <text x="300" y="175" font-family="Arial" font-size="12" text-anchor="middle">State Management & Recovery Protocol</text>
  
  <!-- WatchOS Component -->
  <rect x="480" y="130" width="240" height="60" rx="6" ry="6" fill="url(#watchkit-gradient)" stroke="#FC8019" stroke-width="2"/>
  <text x="600" y="155" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">watchOS Event Detection System</text>
  <text x="600" y="175" font-family="Arial" font-size="12" text-anchor="middle">Multi-modal Sensor Fusion & Alerts</text>
  
  <!-- Backend Services Layer -->
  <rect x="150" y="240" width="600" height="250" rx="8" ry="8" fill="#F5F5F5" stroke="#455A64" stroke-width="1.5"/>
  <text x="450" y="265" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Go WatchKit Backend: Emergency Services</text>
  
  <!-- API Gateway -->
  <rect x="180" y="280" width="540" height="50" rx="6" ry="6" fill="url(#go-gradient)" stroke="#00ADD8" stroke-width="2"/>
  <text x="450" y="310" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">RESTful API Gateway | Emergency Endpoints</text>
  
  <!-- Controller Layer -->
  <rect x="180" y="350" width="250" height="120" rx="6" ry="6" fill="url(#go-gradient)" stroke="#00ADD8" stroke-width="2"/>
  <text x="305" y="370" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Emergency Controllers</text>
  <text x="305" y="395" font-family="Arial" font-size="12" text-anchor="middle">• RegisterEmergencyContact</text>
  <text x="305" y="415" font-family="Arial" font-size="12" text-anchor="middle">• InitiateEmergencySequence</text> 
  <text x="305" y="435" font-family="Arial" font-size="12" text-anchor="middle">• CancelEmergencyState</text>
  <text x="305" y="455" font-family="Arial" font-size="12" text-anchor="middle">• EmergencyStateRecovery</text>
  
  <!-- Service Layer -->
  <rect x="470" y="350" width="250" height="120" rx="6" ry="6" fill="url(#go-gradient)" stroke="#00ADD8" stroke-width="2"/>
  <text x="595" y="370" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Emergency Services</text>
  <text x="595" y="395" font-family="Arial" font-size="12" text-anchor="middle">• EmergencyStateManager</text>
  <text x="595" y="415" font-family="Arial" font-size="12" text-anchor="middle">• ContactNotificationService</text>
  <text x="595" y="435" font-family="Arial" font-size="12" text-anchor="middle">• LocationTrackingService</text> 
  <text x="595" y="455" font-family="Arial" font-size="12" text-anchor="middle">• RecoveryProtocolService</text>
  
  <!-- Data Layer -->
  <rect x="150" y="510" width="600" height="100" rx="8" ry="8" fill="#F5F5F5" stroke="#455A64" stroke-width="1.5"/>
  <text x="450" y="535" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Persistence & State Management Layer</text>
  
  <!-- Repositories -->
  <rect x="180" y="550" width="250" height="40" rx="6" ry="6" fill="url(#go-gradient)" stroke="#00ADD8" stroke-width="2"/>
  <text x="305" y="575" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Emergency Context Repository</text>
  
  <!-- Models -->
  <rect x="470" y="550" width="250" height="40" rx="6" ry="6" fill="url(#go-gradient)" stroke="#00ADD8" stroke-width="2"/>
  <text x="595" y="575" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Emergency State Models</text>
  
  <!-- External Services Layer -->
  <rect x="150" y="630" width="600" height="70" rx="8" ry="8" fill="#F5F5F5" stroke="#455A64" stroke-width="1.5"/>
  <text x="450" y="655" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">External Services Integration</text>
  
  <!-- External Services Components -->
  <rect x="180" y="670" width="165" height="20" rx="3" ry="3" fill="#E8F5E9" stroke="#388E3C" stroke-width="1.5"/>
  <text x="262" y="684" font-family="Arial" font-size="12" text-anchor="middle">Emergency Services API</text>
  
  <rect x="365" y="670" width="165" height="20" rx="3" ry="3" fill="#E1F5FE" stroke="#0288D1" stroke-width="1.5"/>
  <text x="447" y="684" font-family="Arial" font-size="12" text-anchor="middle">SMS/Voice Gateway</text>
  
  <rect x="550" y="670" width="165" height="20" rx="3" ry="3" fill="#FFF3E0" stroke="#E65100" stroke-width="1.5"/>
  <text x="632" y="684" font-family="Arial" font-size="12" text-anchor="middle">Location Services</text>
  
  <!-- Connections -->
  <!-- iOS to WatchOS -->
  <path d="M 420 160 L 480 160" stroke="#333" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  
  <!-- iOS/WatchOS to API Gateway -->
  <path d="M 300 190 L 300 280" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  <path d="M 600 190 L 600 280" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  
  <!-- API Gateway to Controllers -->
  <path d="M 350 330 L 305 350" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  <path d="M 550 330 L 595 350" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  
  <!-- Controllers to Services -->
  <path d="M 430 410 L 470 410" stroke="#673AB7" stroke-width="1.5" fill="none" marker-end="url(#arrow-secondary)"/>
  
  <!-- Services to Repositories -->
  <path d="M 595 470 L 595 510 L 350 510 L 305 550" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  
  <!-- Services to Models -->
  <path d="M 595 470 L 595 550" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  
  <!-- Services to External -->
  <path d="M 305 470 L 305 630" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
  <path d="M 595 470 L 595 630" stroke="#1565C0" stroke-width="1.5" fill="none" marker-end="url(#arrow-primary)"/>
</svg>